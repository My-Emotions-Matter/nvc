import &ArtSuite
{dataNodes} = &Data

class CategoryButton extends PointerActionsMixin FluxComponent
  @subscriptions
    :navState.keyPath
    status: (props) -> props.key

  action: ->
    @models.navState.selectKey @props.key

  hasAncestorKey = (key, lookFor) ->
    if key == lookFor
      true
    else
      {parentKey} = dataNodes[key]
      if parentKey
        hasAncestorKey parentKey, lookFor
      else
        false


  render: ->
    {key} = @props

    selected = key in @keyPath
    text =     key
    color =
      if key == "needs" || dataNodes[key].rootKey == "needs"
        &StyleProps.colors[@status||3] || &StyleProps.primaryColor

      else if hasAncestorKey key, "painful"
        #3399fe # faac11
      else if hasAncestorKey key, "about"
        #ffa9f7
      else if hasAncestorKey key, "pleasurable"
        #ffe838
      else
        #bbb

    color = rgbColor switch
    when selected || @pointerIsDown then color
    else rgbColor(color).blend :white, .5

    Element
      size:       wcw: 1, hch: 1
      cursor:     :pointer
      on:         @buttonHandlers
      clip:       true

      RectangleElement
        inFlow:   false
        color:    color
        radius:   100
        padding:  5
        animators:
          color:  {}
          shadow: duration: .3

      TextElement
        &StyleProps.textStyle
        size:     cs: 1
        align:    :centerCenter
        text:     text.replace /_/g, ' '
        padding:  18
